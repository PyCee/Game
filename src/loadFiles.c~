
#include "loadFiles.h"
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

void nulTerminate(unsigned char **str)
{
	unsigned char *past = *str;
	*str= malloc(sizeof(char) * (1 + strlen(*str)));
	strcpy(*str, past);
	*str[sizeof(*str) - sizeof(char)] = '\0';
	past = 0;
}
// take file and load it into c-string
unsigned char *readFile(const unsigned char * loc)
{
	unsigned char *fileSource;
	FILE *file;
	if ((file = fopen(loc, "r")) == NULL){
		printf("File not Found: %s\n", loc);
		return 0;
	}
	fseek(file,  0, SEEK_END);
	unsigned int fileLen = ftell(file);
	fseek(file,  0, SEEK_SET);
	fileSource = malloc(fileLen);
	fread(fileSource, fileLen, 1, file );
	fclose(file);
	file = 0;
	return fileSource;
}
unsigned char *readXMLElements(const unsigned char *source, const unsigned char *elementOpen)//, const unsigned char *elementClose)
{
	if(elementOpen[0] != '<' || elementOpen[strlen(elementOpen) - 1] != '>'){
		printf("\'%s\' is not a valid xml element", elementOpen);
		return;
	}
	if(!strstr(source, elementOpen)){
		printf("\'%s\' is not an xml element present in the file.\n", elementOpen);
		return;
	}
	unsigned char *elementClose = malloc(sizeof(char) * (strlen(elementOpen) + 2));
	elementClose[0] = '<';
	elementClose[1] = '/';
	unsigned char index;
	for(index = 1; index < strlen(elementOpen); index++){
		elementClose[index + 1] = elementOpen[index];
	}
	
	unsigned char* startIndex = strstr(source, elementOpen) + (strlen(elementOpen) * sizeof(char));
	unsigned char* endIndex = strstr(source, elementClose);
	unsigned char *tmpSource = startIndex;
	unsigned int subStringLen = endIndex - startIndex;
	unsigned char *subString = malloc(subStringLen);
	while(tmpSource < endIndex){
		*subString = *tmpSource;
		subString += sizeof(char);
		tmpSource += sizeof(char);
	}
	*subString = '\0';
	startIndex = 0;
	endIndex = 0;
	tmpSource = 0;
	return subString - subStringLen;
}
